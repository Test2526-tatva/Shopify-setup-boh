{% assign rProducts = customer.metafields.metaobject.registered_product.value %}
{% for rProduct in rProducts %}
  {% assign mProduct = rProduct.mproduct.value %}

  {% assign colour_index = -1 %}
  {% assign swatch_image = '' %}
  {% assign card_image = false %}


  {% assign title = mProduct.title %}

  {% for colour in mProduct.colour.value %}
    {% if rProduct.colour == colour %}
      {% assign colour_index = forloop.index0 %}
      {% break %}
    {% endif %}
  {% endfor %}

  {% for image in mProduct.swatches.value %}
    {% if forloop.index0 == colour_index %}
      {% assign swatch_image = image %}
    {% endif %}
  {% endfor %}
  
  {% for image in mProduct.card_images.value %}
    {% if forloop.index0 == colour_index %}
      {% assign card_image = image %}
    {% endif %}
  {% endfor %}

  {% assign type = 'metaobject' %}
  {% assign id = rProduct.system.handle %}
  {% assign purchase_date = rProduct.purchase_date %}
  {% assign colour_name = rProduct.colour %}

  
  {% render 'repair-card',
    type: type,
    id: id,
    title: title,
    card_image: card_image,
    swatch_image: swatch_image,
    purchase_date: purchase_date,
    colour_name: colour_name,
    only_json: only_json
  %}

{% endfor %}
