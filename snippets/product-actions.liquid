{% assign available = product.selected_variant.inventory_quantity %}

<div class='product-main__actions'>
  {% if product.selected_or_first_available_variant.inventory_quantity == 0 %}
    <button
      type='button'
      style='opacity: 0.5;justify-content: center; {% unless inv_qty != true %}display: none;{% endunless %}'
      class='product-main__detail-cta  open-product-modal'
      data-type='out-of-stock'
    >
      Sold Out | Notify Me
    </button>
  {% else %}
    <button
      {% if product.selected_or_first_available_variant.inventory_quantity == 0 %}
        style='display: none;'
      {% endif %}
      type='submit'
      class='product-main__detail-cta'
      id='addToCartButton'
    >
      <svg
        class='product-main__detail-cta--minus'
        width='14'
        height='15'
        viewBox='0 0 14 15'
        fill='none'
        xmlns='http://www.w3.org/2000/svg'
      >
        <line x1="0.5" y1="-0.5" x2="13.5" y2="-0.5" transform="matrix(1 0 0 -1 0 7.5)" stroke="white" stroke-linecap="round"/>
      </svg>

      <span class='available-text'>
        Add
        <span class='quantity-container'>
          <input
            type='number'
            id='quantityInput'
            name='quantity'
            class='qty'
            value='1'
            min='1'
            max='1000'
            readonly
          >
        </span>
        to Cart
      </span>

      <svg
        class='product-main__detail-cta--plus'
        width='24'
        height='24'
        viewBox='0 0 24 24'
        fill='none'
        xmlns='http://www.w3.org/2000/svg'
      >
        <line x1="12" y1="5.5" x2="12" y2="18.5" stroke="white" stroke-linecap="round"/>
        <line x1="0.5" y1="-0.5" x2="13.5" y2="-0.5" transform="matrix(1 0 0 -1 5 11.5)" stroke="white" stroke-linecap="round"/>
      </svg>
    </button>
  {% endif %}
</div>

<div class='product-errors' data-ajax-cart-messages='form'>
  <!-- Errors and messages appear here -->
</div>

<style>
  .product-main__detail-cta {
    position: relative;
  }

  .quantity-container {
    position: relative;
    display: inline-block;
  }

  .qty {
    background: transparent;
    border: none;
    color: inherit;
    font: inherit;
    text-align: center;
    width: auto;
    min-width: 1ch;
    -moz-appearance: textfield;
    appearance: textfield;
    padding: 0;
    margin: 0;
    cursor: pointer;
  }

  .qty::-webkit-outer-spin-button,
  .qty::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const minusButton = document.querySelector('.product-main__detail-cta--minus');
    const plusButton = document.querySelector('.product-main__detail-cta--plus');
    const quantityInput = document.getElementById('quantityInput');

    function updateInputWidth() {
      quantityInput.style.width = `${quantityInput.value.length}ch`;
    }

    minusButton.addEventListener('click', function (e) {
      e.preventDefault();
      let currentValue = parseInt(quantityInput.value);
      if (currentValue > 1) {
        quantityInput.value = currentValue - 1;
        updateInputWidth();
      }
    });

    plusButton.addEventListener('click', function (e) {
      e.preventDefault();
      let currentValue = parseInt(quantityInput.value);
      if (currentValue < 1000) {
        quantityInput.value = currentValue + 1;
        updateInputWidth();
      }
    });

    updateInputWidth();
  });
</script>
